<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapas</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">

    <!-- Configuración y rutas absolutas -->
    <script src="/frontend/config/config.js"></script>

    <!-- CSS del proyecto -->
    <script>
        loadCSS("header_footer.css");
        loadCSS("plantilla_css.css");
        loadCSS("mapa.css");
        // Cargar favicon dinámicamente
        loadFavicon("favicon.png");
    </script>

    <!-- JS dependientes -->
    <script type="module" src="/frontend/javascript/header_footer.js" defer></script>
    <script src="/frontend/javascript/script_filtro_tabla.js" defer></script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>       
   
</head>

<body class="bg-white text-dark d-flex flex-column">

    <!-- HEADER -->
    <div id="header-placeholder"></div>

    <!-- LAYOUT CON SIDEBAR -->
    <div class="d-flex flex-grow-1">

        <!-- SIDEBAR -->
        <div id="sidebar-placeholder" class="sidebar-bg"></div>

        <!-- MAIN CONTENT -->
        <main class="p-3 w-100">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1 class="mb-0">Mapa de Emergencias</h1>
            </div>
            <div>
                <p>[Migas de pan]</p>
            </div>

            <!-- Map container -->
            <div id="map-container">
                <div id="map"></div>
            </div>

            <script>
                // Inicializar mapa
                let map = L.map('map').setView([40.4168, -3.7038], 13);

                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    maxZoom: 19,
                }).addTo(map);

                // Función para añadir incidencias
                function agregarIncidencia(lat, lon, nombre, descripcion, funcionario = "N/A") {
                    L.marker([lat, lon])
                        .addTo(map)
                        .bindPopup(`<b>${nombre}</b><br>${descripcion}<br>Funcionario: ${funcionario}`);
                }

                // Ejemplos
                agregarIncidencia(40.417, -3.703, "Incendio en vivienda", "Fuego en un tercer piso, 2 unidades enviadas");
                agregarIncidencia(40.410, -3.700, "Falsa alarma", "Descripción de ejemplo");

                // Click para agregar incidencia
                map.on('click', function (e) {
                    let lat = e.latlng.lat;
                    let lon = e.latlng.lng;

                    let nombre = prompt("Nombre de la incidencia:");
                    let descripcion = prompt("Descripción de la incidencia:");

                    if (nombre && descripcion) {
                        agregarIncidencia(lat, lon, nombre, descripcion);
                    }
                });
            </script>
        </main>
    </div>
    

    <!-- FOOTER -->
    <div id="footer-placeholder" class="mt-auto"></div>
    <!-- ALERT-->
    <div id="alert-container" class="position-fixed top-0 end-0 p-3" style="z-index: 1080;"></div>

</body>

</html>
